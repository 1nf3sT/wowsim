<html>
    <head>
        <title>TBC Elemental Simulator</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="uikit.min.css" />

        <script src="wasm_exec.js"></script>
        <script src="uikit.min.js"></script>
        <script src="uikit-icons.min.js"></script>
        <script src="ui.js"></script>
        <link rel="stylesheet" href="ui.css" />
        <script>
            if (!WebAssembly.instantiateStreaming) { // polyfill
                WebAssembly.instantiateStreaming = async (resp, importObject) => {
                    const source = await (await resp).arrayBuffer();
                    return await WebAssembly.instantiate(source, importObject);
                };
            }
    
            const go = new Go();
            let mod, inst;
            WebAssembly.instantiateStreaming(fetch("lib.wasm"), go.importObject).then(
                async result => {
                    mod = result.module;
                    inst = result.instance;
                    console.log("loading wasm...")
                    await go.run(inst);
                }
            );
        </script>
    </head>
    <body>
        <div id="root">
            <h4>TBC Elemental Shaman Simulator</h4>
            <ul id="inputtabs" uk-tab="connect: #inputdata;swiping" >
                <li class="uk-active"><a href="#">Gear</a></li>
                <li><a href="#">Talents</a></li>
                <li><a href="#">Buffs</a></li>
                <li><a href="#">Notes</a></li>
            </ul>
            <ul id="inputdata" class="uk-switcher uk-margin">
                <li id="gear" style="height: 35%;overflow: auto;min-height: 400px;">
                    <div class="uk-grid-small uk-child-width-expand@s uk-text-center" uk-grid>
                        <div>
                            <div class="uk-grid-small uk-child-width-expand@s uk-text-center" uk-grid>
                                <div>
                                    <div id="equiphead">
                                        <button id="equipheaditem" class="uk-button uk-button-default" onclick="focusSearch(this, event)" onclick="focusSearch(this, event)" type="button">?</button>
                                        <div uk-dropdown="mode: click">
                                            <input id="equipheadsearch" onkeyup="searchHandler(this, event)" onblur="clearSearch(this)" type="text"><button onclick="removeGear(this)">Remove</button></button></input>
                                            <ul class="uk-nav uk-dropdown-nav">
                                            </ul>
                                        </div>
                                    </div>
                                    <div id="equipneck">
                                        <button id="equipneckitem" class="uk-button uk-button-default" onclick="focusSearch(this, event)" type="button">?</button>
                                        <div uk-dropdown="mode: click">
                                            <input id="equipnecksearch" onkeyup="searchHandler(this, event)" onblur="clearSearch(this)" type="text"><button onclick="removeGear(this)">Remove</button></button></input>
                                            <ul class="uk-nav uk-dropdown-nav">
                                            </ul>
                                        </div>
                                    </div>
                                    <div id="equipshoulder">
                                        <button id="equipshoulderitem" class="uk-button uk-button-default" onclick="focusSearch(this, event)" type="button">?</button>
                                        <div uk-dropdown="mode: click">
                                            <input id="equipshouldersearch" onkeyup="searchHandler(this, event)" onblur="clearSearch(this)" type="text"><button onclick="removeGear(this)">Remove</button></button></input>
                                            <ul class="uk-nav uk-dropdown-nav">
                                            </ul>
                                        </div>
                                    </div>
                                    <div id="equipback">
                                        <button id="equipbackitem" class="uk-button uk-button-default" onclick="focusSearch(this, event)" type="button">?</button>
                                        <div uk-dropdown="mode: click">
                                            <input id="equipbacksearch" onkeyup="searchHandler(this, event)" onblur="clearSearch(this)" type="text"><button onclick="removeGear(this)">Remove</button></button></input>
                                            <ul class="uk-nav uk-dropdown-nav">
                                            </ul>
                                        </div>
                                    </div>
                                    <div id="equipchest">
                                        <button id="equipchestitem" class="uk-button uk-button-default" onclick="focusSearch(this, event)" type="button">?</button>
                                        <div uk-dropdown="mode: click">
                                            <input id="equipchestsearch" onkeyup="searchHandler(this, event)" onblur="clearSearch(this)" type="text"><button onclick="removeGear(this)">Remove</button></button></input>
                                            <ul class="uk-nav uk-dropdown-nav">
                                            </ul>
                                        </div>
                                    </div>
                                    <div id="equipwrist">
                                        <button id="equipwristitem" class="uk-button uk-button-default" onclick="focusSearch(this, event)" type="button">?</button>
                                        <div uk-dropdown="mode: click">
                                            <input id="equipwristsearch" onkeyup="searchHandler(this, event)" onblur="clearSearch(this)" type="text"><button onclick="removeGear(this)">Remove</button></button></input>
                                            <ul class="uk-nav uk-dropdown-nav">
                                            </ul>
                                        </div>
                                    </div>
                                    <div id="equipweapon">
                                        <button id="equipweaponitem" class="uk-button uk-button-default" onclick="focusSearch(this, event)" type="button">?</button>
                                        <div uk-dropdown="mode: click">
                                            <input id="equipweaponsearch" onkeyup="searchHandler(this, event)" onblur="clearSearch(this)" type="text"><button onclick="removeGear(this)">Remove</button></button></input>
                                            <ul class="uk-nav uk-dropdown-nav">
                                            </ul>
                                        </div>
                                    </div>
                                    <div id="equipoffhand">
                                        <button id="equipoffhanditem" class="uk-button uk-button-default" onclick="focusSearch(this, event)" type="button">?</button>
                                        <div uk-dropdown="mode: click">
                                            <input id="equipoffhandsearch" onkeyup="searchHandler(this, event)" onblur="clearSearch(this)" type="text"><button onclick="removeGear(this)">Remove</button></button></input>
                                            <ul class="uk-nav uk-dropdown-nav">
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <div class="uk-grid-small uk-child-width-expand@s uk-text-center" uk-grid>
                                <div>
                                    <div id="equiphands">
                                        <button id="equiphandsitem"class="uk-button uk-button-default" onclick="focusSearch(this, event)" type="button">?</button>
                                        <div uk-dropdown="mode: click">
                                            <input id="equiphandssearch" onkeyup="searchHandler(this, event)" onblur="clearSearch(this)" type="text"><button onclick="removeGear(this)">Remove</button></button></input>
                                            <ul class="uk-nav uk-dropdown-nav">
                                            </ul>
                                        </div>
                                    </div>
                                    <div id="equipwaist">
                                        <button id="equipwaistitem" class="uk-button uk-button-default" onclick="focusSearch(this, event)" type="button">?</button>
                                        <div uk-dropdown="mode: click">
                                            <input id="equipwaistsearch" onkeyup="searchHandler(this, event)" onblur="clearSearch(this)" type="text"><button onclick="removeGear(this)">Remove</button></button></input>
                                            <ul class="uk-nav uk-dropdown-nav">
                                            </ul>
                                        </div>
                                    </div>
                                    <div id="equiplegs">
                                        <button id="equiplegsitem" class="uk-button uk-button-default" onclick="focusSearch(this, event)" type="button">?</button>
                                        <div uk-dropdown="mode: click">
                                            <input id="equiplegssearch" onkeyup="searchHandler(this, event)" onblur="clearSearch(this)" type="text"><button onclick="removeGear(this)">Remove</button></button></input>
                                            <ul class="uk-nav uk-dropdown-nav">
                                            </ul>
                                        </div>
                                    </div>
                                    <div id="equipfeet">
                                        <button id="equipfeetitem" class="uk-button uk-button-default" onclick="focusSearch(this, event)" type="button">?</button>
                                        <div uk-dropdown="mode: click">
                                            <input id="equipfeetsearch" onkeyup="searchHandler(this, event)" onblur="clearSearch(this)" type="text"><button onclick="removeGear(this)">Remove</button></button></input>
                                            <ul class="uk-nav uk-dropdown-nav">
                                            </ul>
                                        </div>
                                    </div>
                                    <div id="equipfinger1">
                                        <button id="equipfinger1item" class="uk-button uk-button-default" onclick="focusSearch(this, event)" type="button">?</button>
                                        <div uk-dropdown="mode: click">
                                            <input id="equipfinger1search" onkeyup="searchHandler(this, event)" onblur="clearSearch(this)" type="text"><button onclick="removeGear(this)">Remove</button></button></input>
                                            <ul class="uk-nav uk-dropdown-nav">
                                            </ul>
                                        </div>
                                    </div>
                                    <div id="equipfinger2">
                                        <button id="equipfinger2item" class="uk-button uk-button-default" onclick="focusSearch(this, event)" type="button">?</button>
                                        <div uk-dropdown="mode: click">
                                            <input id="equipfinger2search" onkeyup="searchHandler(this, event)" onblur="clearSearch(this)" type="text"><button onclick="removeGear(this)">Remove</button></button></input>
                                            <ul class="uk-nav uk-dropdown-nav">
                                            </ul>
                                        </div>
                                    </div>
                                    <div id="equiptrinket1">
                                        <button id="equiptrinket1item" class="uk-button uk-button-default" onclick="focusSearch(this, event)" type="button">?</button>
                                        <div uk-dropdown="mode: click">
                                            <input id="equiptrinket1search" onkeyup="searchHandler(this, event)" onblur="clearSearch(this)" type="text"><button onclick="removeGear(this)">Remove</button></button></input>
                                            <ul class="uk-nav uk-dropdown-nav">
                                            </ul>
                                        </div>
                                    </div>
                                    <div id="equiptrinket2">
                                        <button id="equiptrinket2item" class="uk-button uk-button-default" onclick="focusSearch(this, event)" type="button">?</button>
                                        <div uk-dropdown="mode: click">
                                            <input id="equiptrinket2search" onkeyup="searchHandler(this, event)" onblur="clearSearch(this)" type="text"><button onclick="removeGear(this)">Remove</button></button></input>
                                            <ul class="uk-nav uk-dropdown-nav">
                                            </ul>
                                        </div>
                                    </div>
                                    <div id="equiptotem">
                                        <button id="equiptotemitem" class="uk-button uk-button-default" onclick="focusSearch(this, event)" type="button">?</button>
                                        <div uk-dropdown="mode: click">
                                            <input id="equiptotemsearch" onkeyup="searchHandler(this, event)" onblur="clearSearch(this)" type="text"><button onclick="removeGear(this)">Remove</button></button></input>
                                            <ul class="uk-nav uk-dropdown-nav">
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <div id="gearstats">
                                <table>
                                    <tr><th>Stat</th><th>Gear</th></tr>
                                    <tr><td><label>Int</label></td> <td><label id="statint">0</label><td></td></tr>
                                    <tr><td><label>Stm</label></td> <td><label id="statstm">0</label><td></td></tr>
                                    <tr><td><label title="Includes crit from int on gear.">SpellCrit*</label></td> <td><label id="statspellcrit" title="Includes crit from INT">0</label><td></td></tr>
                                    <tr><td><label>SpellHit</label></td> <td><label id="statspellhit">0</label><td></td></tr>
                                    <tr><td><label>SpellDmg</label></td> <td><label id="statspelldmg">0</label><td></td></tr>
                                    <tr><td><label>Haste</label></td> <td><label id="stathaste">0</label><td></td></tr>
                                    <tr><td><label>MP5</label></td> <td><label id="statmp5">0</label><td></td></tr>
                                    <tr><td><label title="This is just bonus mana from gear int, does not include base.">Mana*</label></td> <td><label id="statmana" title="This is just bonus mana from gear (int), does not include base.">0</label><td></td></tr>
                                    <tr><td><label>SpellPen</label></td> <td><label id="statspellpen">0</label><td></td></tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </li>
                <li id="talents" style="height: 35%;overflow: auto;">
                    <h4>Standard Elemental Build</h4>
                    <b>Elemental:</b> Convection, Concussion, Call of Thunder, Elemental Focus, Elemental Fury, Lightning Mastery, UnrelentingStorm(3/5), Elemental Mastery, Lightning Overload, Totem of Wrath<br />
                    <b>Resto:</b> Natures Guidance, Tidal Mastery<br />
                </li>
                <li id="buffs" style="height: 35%;overflow: auto;">
                    <div class="uk-margin uk-grid-small uk-child-width-auto uk-grid" style="height: 35%"> 
                        <div class="uk-margin uk-grid-small uk-child-width-auto uk-grid buffs" style=>
                            <b style="width: 100%;text-align: right;font-size: 0.7em;color: #1e87f0;">Raid Buffs</b>
                            <label><input id="buffai" class="uk-checkbox" type="checkbox" checked>Arcane Int</label>
                            <label><input id="buffgotw" class="uk-checkbox" type="checkbox" checked>Gift of the Wild</label>
                            <label><input id="buffbk" class="uk-checkbox" type="checkbox" checked>Blessing of Kings</label>
                            <label><input id="buffibow" class="uk-checkbox" type="checkbox" checked>Improved Blessing of Wisdom</label>
                        </div>
                        <div class="uk-margin uk-grid-small uk-child-width-auto uk-grid buffs" style=>
                                <b style="width: 100%;text-align: right;font-size: 0.7em;color: #1e87f0;">Party Buffs</b>
                                <label><input id="buffmoon" class="uk-checkbox" type="checkbox">Moonkin Aura</label>
                                <label>Bloodlust: <select id="buffbl" class="buffdrop" style="width: 50px" value="1">
                                    <option class="buffdrop">0</option>
                                    <option class="buffdrop" selected>1</option>
                                    <option class="buffdrop">2</option>
                                    <option class="buffdrop">3</option>
                                    <option class="buffdrop">4</option>
                                    <option class="buffdrop">5</option>
                                </select></label>
                                <label>Shadow Priest DPS: <input id="buffspriest" class="uk-textbox buffdrop" type="text" style="width: 40px" value="0"></label>
                        </div>
                        <div class="uk-margin uk-grid-small uk-child-width-auto uk-grid buffs" style=>
                            <b style="width: 100%;text-align: right;font-size: 0.7em;color: #1e87f0;">Self Buffs</b>
                            <label><input id="sbufws" class="uk-checkbox" type="checkbox" checked>Water Shield</label>
                        </div>

                        <div class="uk-margin uk-grid-small uk-child-width-auto uk-grid buffs" style=>
                            <b style="width: 100%;text-align: right;font-size: 0.7em;color: #1e87f0;">Target Debuffs</b>
                            <label><input id="debuffjow" class="uk-checkbox" type="checkbox" checked>Judgement of Wisdom</label>
                        </div>

                        <div class="uk-margin uk-grid-small uk-child-width-auto uk-grid buffs" style=>
                            <b style="width: 100%;text-align: right;font-size: 0.7em;color: #1e87f0;">Consumes</b>
                            <label><input id="confbl" class="uk-checkbox" type="checkbox">Flask of Blinding Light</label>
                            <label><input id="confmr" class="uk-checkbox" type="checkbox">Flask of Mighty Restoration</label>
                            <label><input id="conbwo" class="uk-checkbox" type="checkbox" checked>Brilliant Wizard Oil</label>
                            <label><input id="conmm" class="uk-checkbox" type="checkbox" checked>Major Mageblood</label>
                            <label><input id="conbb" class="uk-checkbox" type="checkbox">Blacked Basalisk</label>
                            <label><input id="consmp" class="uk-checkbox" type="checkbox" checked>Super Mana Potion</label>
                            <label><input id="condr" class="uk-checkbox" type="checkbox" checked>Dark Rune</label>        
                        </div>
                        <div class="uk-margin uk-grid-small uk-child-width-auto uk-grid buffs" style=>
                            <b style="width: 100%;text-align: right;font-size: 0.7em;color: #1e87f0;">Totems</b>
                            <label><input id="totms" class="uk-checkbox" type="checkbox" checked>Mana Spring</label>
                            <label><input id="totwoa" class="uk-checkbox" type="checkbox" checked>Wrath of Air</label>
                            <label>Totem of Wrath: <select id="totwr" class="buffdrop" list="ttwv" style="width: 50px" value="1">
                                <option class="buffdrop">0</option>
                                <option class="buffdrop" selected>1</option>
                                <option class="buffdrop">2</option>
                                <option class="buffdrop">3</option>
                                <option class="buffdrop">4</option>
                                <option class="buffdrop">5</option>
                            </select></label>
                        </div>
                    </div>
                </li>
                <li id="notes" style="height: 35%;overflow: auto;">
                    <ul>
                        <li>All activatable abilities and items are activated on CD (usually at the start of fight).</li>
                        <li>Gems and gemming bonuses are not implemented.</li>
                        <li>Set bonuses are not implemented.</li>
                        <li>Unsure of exact spell pen. Using classic 2.5% chance for a 25% partial resist (this is probably wrong).</li>
                    </ul>
                </li>
            </ul>
            <div id="calcdiv">
                <ul id="calctabs" uk-tab="connect: #calcs">
                    <li class="uk-active"><a href="#">Sim</a></li>
                    <li><a href="#">Histogram</a></li>
                    <li><a href="#">Stats</a></li>
                    <li><a href="#">Hasted Rotations</a></li>
                </ul>
                <ul id="calcs" class="uk-switcher uk-margin">
                    <li>
                        <div style="text-align: right">
                            <button onclick="runsim();">Run Simulation</button>
                            Iterations: <input id="iters" type="text" value="1000" style="width: 60px"></input>
                            Duration: <input id="dur" type="text" value="300" style="width: 60px"></input>
                        </div>
                        <div id="output" style="overflow: auto; top: 0px; bottom: 0px;"></div>
                    </li>
                    <li style="height: 35%">
                        DPS Histogram
                    </li>
                    <li style="height: 35%">
                        Final Stats:
                        <div id="fstats"></div>
                    </li>
                    <li style="height: 35%">
                        <div style="text-align: right;">
                            <button onclick="hastedRotations();">Optimize Haste Rotation</button>
                        </div>
                        <ul>
                            <li>Does not use bloodlust (ignores BL settings above)</li>
                            <li>Uses all other options, but replaces the haste stat.</li>
                            <li>Do not recommend using Quags Eye</li>
                            <li>Not mana optimized, this is showing max dps for a 60s fight</li>
                            <li>Even a very small amount of haste like 20 makes CL / 4LB > CL / 3LB</li>
                        </ul>
                        <div id="hasterots"></div>
                    </li>
                </ul>    
            </div>
        </div>
    </body>
</html>
